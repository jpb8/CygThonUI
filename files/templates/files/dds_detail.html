{% extends 'base.html' %}
{% block body_block %}
<div class="container">
    <div class="row file-header">
        <h2>{{ dds.base_file }}</h2>
        <ul>
            <li>Project - {{ dds.project }}</li>
            <li>Uploaded - {{ dds.uploaded }}</li>
        </ul>
        <button onclick="window.location.href = '{% url 'files:dds_export' %}?id={{ dds.pk }}';">Export File!</button>
        <button onclick="window.location.href = '{% url 'files:dds_mappings_export' %}?id={{ dds.pk }}';">Export
            Mappings to Excel
        </button>
    </div>
    <div class="row">
        <div class="col">
            <div class="function-container">
                <h2>Validation Functions</h2>
                <div class="file-function">
                    <div class="file-function-desc">
                        Find all Mapped points without a matching DEID in the DTF
                    </div>
                    <div class="file-fuction-body">
                        <form method="POST" action="{% url 'files:orphans' %}" id="dds-orphans">
                            {% csrf_token %}
                            <label for="dtf-id">Import Mappings</label>
                            <select name="dtf-id" id="dtf-id">
                                {% if dtfs %}
                                {% for d in dtfs %}
                                <option value="{{ d.pk }}">{{ d.file }}</option>
                                {% endfor %}
                                {% endif %}
                            </select>
                            <input hidden name="dds-id" value="{{ dds.pk }}">
                            <button class="btn-sm btn-primary" type="submit">Find Orphans</button>
                        </form>
                    </div>
                </div>
                <div class="file-function">
                    <div class="file-function-desc">
                        Validate first 4 letters in facility match device
                    </div>
                    <div class="file-function-body">
                        <div class="dds-util btn btn-primary" data-id="{{ dds.pk }}"
                             data-url="{% url 'files:correct_dec_check' %}?id={{ dds.pk }}">
                            GO
                        </div>
                    </div>

                </div>
                <div class="file-function">
                    <div class="file-function-desc">
                        Validate all mapped facilities exist in facilities export
                    </div>
                    <div class="file-function-body">
                        <form method="post" enctype="multipart/form-data" action="{% url 'files:fac_exist' %}"
                              id="dds-facs">
                            {% csrf_token %}
                            <label>Excel facility upload</label>
                            <input type="file" name="facs"><br>
                            <input hidden name="dds-id" value="{{ dds.pk }}">
                            <button class="btn btn-primary" type="submit">GO</button>
                        </form>
                    </div>
                </div>
                <div class="file-function">
                    <div class="file-function-desc">
                        Validate all mapped facilities exist in facilities export
                    </div>
                    <div class="file-function-body">
                        <form method="post" enctype="multipart/form-data" action="{% url 'files:validate_commands' %}"
                              id="dds-cmds">
                            {% csrf_token %}
                            <select name="dtf-id">
                                {% if dtfs %}
                                {% for d in dtfs %}
                                <option value="{{ d.pk }}">{{ d.file }}</option>
                                {% endfor %}
                                {% endif %}
                            </select>
                            <label>Command Upload</label>
                            <input type="file" name="cmds"><br>
                            <input hidden name="dds-id" value="{{ dds.pk }}">
                            <button class="btn btn-primary" type="submit">GO</button>
                        </form>
                    </div>
                </div>
                <div class="file-function">
                    <div class="file-function-desc">
                        Find all unmapped facilities
                    </div>
                    <div class="file-function-body">
                        <div class="dds-util btn btn-primary" data-id="{{ dds.pk }}"
                             data-url="{% url 'files:unmapped_facs' %}?id={{ dds.pk }}">
                            Check Missing Facilities
                        </div>
                    </div>
                    <div class="btn btn-primary" id="map-unmapped" data-id="{{ dds.pk }}" data-map="True"
                         data-url="{% url 'files:unmapped_facs' %}">
                        Check and map
                    </div>
                </div>
            </div>
            <div class="file-function-container">
                <form method="post" enctype="multipart/form-data" action="{% url 'files:dds_add_mappings' %}"
                      id="dds-mapping">
                    {% csrf_token %}
                    <h3>Import Mappings</h3><br>
                    <a href="{% url 'files:mapping_template' %}">Download Template</a><br>
                    <label>Mappings Excel</label>
                    <input type="file" name="mappings"><br>
                    <input type="checkbox" name="died-only">DEID Only<br>
                    <select name="dtf-id">
                        {% if dtfs %}
                        {% for d in dtfs %}
                        <option value="{{ d.pk }}">{{ d.file }}</option>
                        {% endfor %}
                        {% endif %}
                    </select><br>
                    <input hidden name="dds-id" value="{{ dds.pk }}">
                    <button class="btn btn-primary" type="submit">Map!</button>
                </form>
            </div>
        </div>
        <div class="col" id="device-info">
            <h1>All Devices</h1>
            {% if devices %}
            {% include 'files/snippets/device_accord.html' with devices=devices %}
            {% endif %}
        </div>
    </div>
    <div class="modal fade" id="response-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Response Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}